<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Immutable Infrastructure - Beyond Stateless</title>

        <meta name="description" content="A presentation about immutable infrastructure and its application for stateful services">
        <meta name="author" content="Jorge Dias">

        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.css">
        <link rel="stylesheet" href="css/theme/sky.css" id="theme">

        <!-- Theme used for syntax highlighting of code -->
        <link rel="stylesheet" href="lib/css/zenburn.css">
        <link rel="stylesheet" href="css/custom.css">

        <!-- Printing and PDF exports -->
        <script>
         var link = document.createElement( 'link' );
         link.rel = 'stylesheet';
         link.type = 'text/css';
         link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
         document.getElementsByTagName( 'head' )[0].appendChild( link );
        </script>

        <!--[if lt IE 9]>
            <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="reveal">

            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
                <section>
                    <h1>Immutable Infrastructure</h1>
                    <h2>Beyond Stateless</h2>
                    <p>
                        <small>By <a href="https://mrdias.com">Jorge Dias</a></small>
                    </p>
                </section>

                <section>
                    <h1>Salut Bucuresti!</h1>
                </section>

                <section>
                    <h2>Jorge Dias</h2>
                    <p>
                        Father üë®‚Äçüë©‚Äçüëß‚Äçüë¶ , coder üë®‚Äçüíª, polyglot üåê, human ü§ñ.
                    </p>
                    <p>
                        Infrastructure engineer by Schibsted.
                    </p>
                </section>

                <section>
                    <h2>Agenda</h2>
                    <ul>
                        <li>Introduction to immutable infrastructure</li>
                        <li>Implementing it in practice</li>
                        <li>Application for stateful services</li>
                    </ul>
                </section>

                <section class="lefty title">
                    <h2>What is<br/> immutable<br/> infrastructure?</h2>
                </section>

                <section>
                    <h2>Immutable</h2>
                    <p>
                        <small>
                            adjective - im¬∑mu¬∑ta¬∑ble - \ (Àå)i(m)-Ààmy√º-t…ô-b…ôl \
                        </small>
                    </p>
                    <p>
                        not capable of or susceptible to change
                    </p>
                </section>

                <section data-transition="zoom-in fade-out">
                    <h2>Paradigm</h2>
                    <p>
                        Components are replaced rather than changed
                    </p>
                    <p>
                        Build new servers on every deploy and discard the old ones
                    </p>
                </section>

                <section>
                    <h2> Traditional infrastructure (the old ways)</h2>
                </section>
                <section data-background-image="images/problems.svg" data-background-size="contain"></section>

                <section class="lefty title">
                    <h2> A new challenge </h2>
                </section>

                <section>
                    <ul>
                        <li>New tools are needed</li>
                        <li>Automation is a necessity</li>
                        <li>Architecture changes for apps</li>
                    </ul>
                </section>

                <section>
                    <h2> Application Architecture </h2>
                </section>

                <section>
                    <h2> 12Factor APP </h2>
                    <ul>
                        <li>General guidelines for building SAAS applications</li>
                        <li>Great ideas for working on the cloud</li>
                    </ul>
                </section>

                <section data-transition="fade-out">
                    <h2>Config</h2>
                    <p>
                        Config is everything that is likely<br/> to change between deploys
                    </p>
                </section>

                <section  data-transition="fade-in fade-out">
                    <ul>
                        <li>Separate your config from your code</li>
                        <li>Store config in the environment</li>
                        <li>Use environment variables</li>
                    </ul>
                </section>

                <section data-transition="fade-out">
                    <h2>Processes</h2>
                    <p>
                        Processes are stateless and share-nothing
                    </p>
                </section>

                <section  data-transition="fade-in fade-out">
                    <ul>
                        <li>Data that needs to persist must be stored in a stateful backing service</li>
                        <li>Filesystem of the process can be used as a brief, single-transaction cache</li>
                    </ul>
                </section>

                <section>
                    <h2>Disposability</h2>
                    <ul>
                        <li>Processes are disposable, meaning they can be started or stopped at a moment‚Äôs notice</li>
                        <li>Processes shut down gracefully when they receive a SIGTERM</li>
                        <li>Processes should also be robust against sudden death</li>
                    </ul>
                </section>

                <section data-background-image="images/build-release-run.svg" data-background-size="95%">
                </section>

                <section class="pipeline">
                    <h2>Creating builds</h2>
                    <img src="images/pipeline.svg"/>
                </section>

                <section>
                    <h2>Releasing Code</h2>
                    <img class="config" src="images/config.svg"/>
                </section>

                <section>
                    <h3>Deployment Strategies</h3>
                    <ul>
                        <li>Rolling terminate</li>
                        <li>Blue/green deployments</li>
                        <li>Canary releases</li>
                    </ul>
                </section>

                <section class="lefty title">
                    <h2> Stateful Services </h2>
                </section>

                <section>
                    <h2>Context</h2>
                    <ul>
                        <li>Storage team offers managed databases to internal teams</li>
                        <li>Small team of 5 engineers and 1 manager</li>
                        <li>10s of clusters in production</li>
                        <li>100s of servers</li>
                    </ul>
                </section>

                <section>
                    <h2> Data has to <br/> live somewhere </h2>
                    <ul>
                        <li>File system</li>
                        <li>Databases</li>
                    </ul>
                </section>

                <section>
                    <h2> Immutable Databases? </h2>
                    <p>
                        Kind of...
                    </p>
                </section>

                <section data-transition="fade">
                    <ul>
                        <li>Treat the system like you have no state</li>
                        <li class="fragment fade-up">Any node can die and the system must be OK</li>
                        <li class="fragment fade-up">Embrace distributed systems</li>
                        <li class="fragment fade-up">‚ÄúControlled chaos‚Äú‚Ñ¢Ô∏è through Continuous deployment</li>
                    </ul>
                </section>

                <section>
                    <h2>Isn't that dangerous?</h2>
                    <blockquote>
                        &ldquo;
                        If we can‚Äôt kill a node in a controlled matter then when it innevitably fails we‚Äôll be in real trouble.
                        &rdquo;
                    </blockquote>
                    <small>Yours Truly</small>
                </section>

                <section>
                    <h2>Creating a cluster</h2>
                </section>

                <section>
                    <h2>Node lifecycle</h2>
                    <p>
                      In house solution alternative to Priam from Netflix
                    </p>
                </section>

                <section>
                    <ul>
                        <li>Load configuration</li>
                        <li class="fragment fade-up">Generate configuration files</li>
                        <li class="fragment fade-up">Gathers information about the cluster from cloud provider</li>
                        <li class="fragment fade-up">If it‚Äôs the first node bootstraps the cluster</li>
                        <li class="fragment fade-up">Joins an existing cluster as a new node or another node‚Äôs replacement</li>
                        <li class="fragment fade-up">Respond to healthcheck to indicate success</li>
                    </ul>
                </section>

                <section>
                    <h2>Rolling Updates</h2>

                    <ul>
                        <li>Small framework extensible for many cluster types</li>
                        <li>Currently supports Cassandra, Kafka and Zookeeper</li>
                    </ul>
                </section>

                <section>
                    <h2>Update cloud <br/>infrastructure</h2>
                    <ul>
                        <li>
                            Deploy infrastructure stack
                        </li>
                        <li>Create resources, permissions, network rules</li>
                    </ul>
                </section>

                <section>
                    <h2>Updating instances</h2>
                    <ul>
                        <li>Check cluster health</li>
                        <li>Functional tests + monitoring information</li>
                    </ul>

                </section>

                <section>
                    <ul>
                        <li>Send signal to node to start shutdown</li>
                        <li class="fragment fade-left">Wait for cleanup and node termination</li>
                        <li class="fragment fade-left">Wait for new node to be spawn</li>
                        <li class="fragment fade-left">Wait for the cluster recovery and proceed with next node</li>
                    </ul>
                </section>

                <section>
                    <h2>Our tools</h2>
                </section>

                <section>
                    <h2>Embrace your cloud provider</h2>
                    <ul>
                        <li>We use many AWS services</li>
                        <li>Cloudformation for infrastructure as code</li>
                        <li>API to gather cluster information</li>
                    </ul>
                </section>

                <section>
                    <ul>
                        <li>SSM for sending commands</li>
                        <li>Dynamodb for configuration</li>
                        <li>S3 for storing backups</li>
                    </ul>
                </section>

                <section>
                    <h2>Preparing for disaster</h2>
                    <p>If you loose customers data you‚Äôre in BIG trouble</p>
                </section>

                <section>
                    <p>
                        Developed an open source tool <br/>
                        <a href="https://github.com/schibsted/cassandra-backup">
                            Cassandra Backup
                        </a>
                    </p>
                </section>

                <section class="lefty title">
                    <h2> Summary </h2>
                </section>

                <section>
                    <h2>
                        Advantages
                    </h2>
                    <ul>
                        <li>Known state and less deployment failures</li>
                        <li>Testing infrastructure in isolation is possible</li>
                        <li>Consistent environments between dev/pre/pro</li>
                        <li>Easy to rollback</li>
                    </ul>
                </section>

                <section>
                    <h2>Trade offs</h2>
                    <ul>
                        <li>High upfront investment</li>
                        <li>Rolling update of a whole cluster takes time</li>
                    </ul>
                </section>

                <section>
                    <h2>Take aways</h2>
                    <ul>
                        <li>Immutable infrastructure is a means to an end not a goal.</li>
                        <li>It‚Äôs not about the tools it‚Äôs about the ideas.</li>
                        <li>You can implement it gradually.</li>
                        <li>It may not be a good fit for you.</li>
                    </ul>
                </section>

                <section class="thankyou">
                    <h2>Thank you</h2>
                    <p>
                        You can reach me:
                    </p>
                    <ul>
                        <li><a href="https://mrdias.com">https://mrdias.com</a></li>
                        <li><a href="https://github.com/diasjorge">@diasjorge</a> on Github</li>
                        <li><a href="https://twitter.com/dias_jorge">@dias_jorge</a> on Twitter</li>
                    </ul>
                </section>

            </div>

        </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>

        <script>

         // More info https://github.com/hakimel/reveal.js#configuration
         Reveal.initialize({
             width: 1280,
             height: 700,

             controls: true,
             progress: true,
             history: true,
             center: true,

             transition: 'slide', // none/fade/slide/convex/concave/zoom

             // More info https://github.com/hakimel/reveal.js#dependencies
             dependencies: [
                 { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                 { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                 { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                 { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                 { src: 'plugin/search/search.js', async: true },
                 { src: 'plugin/zoom-js/zoom.js', async: true },
                 { src: 'plugin/notes/notes.js', async: true }
             ]
         });

        </script>

    </body>
</html> -->
